!function(){const e=new Map,t=3e5;function n(e){const t=document.createElement("div");t.style.backgroundColor="red",t.style.color="white",t.style.padding="10px",t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.zIndex="9999",t.textContent=e,document.body.appendChild(t),setTimeout((()=>{document.body.removeChild(t)}),5e3)}async function o(o){const r=o.split("\n");let d=0;(function(e){const t=e.split(";");return 4===t.length&&"numCommercant"===t[0].trim()&&"codeBanque"===t[1].trim()&&"rang"===t[2].trim()&&"typeContrat"===t[3].trim()})(r[0])&&(d=1);const l=[],c=/\d{7}/,i=/\d{5}/,s=/\d{3}/,p=/(CB|CLESS)/i;for(let n=d;n<r.length;n++){const o=r[n].trim();if(o){let n,r,d,m;o.split(/[;\t\s]+/).forEach((e=>{!n&&c.test(e)?n=e:!r&&i.test(e)?r=e:!d&&s.test(e)?d=e:!m&&p.test(e)&&(m=e.toUpperCase())})),m||(m="CB");const u=`${n}-${r}-${d}-${m}`,y=e.get(u);if(y&&Date.now()-y.timestamp<t)l.push({numCommercant:n.trim(),codeBanque:r.trim(),rang:d.trim(),typeContrat:m.trim(),result:y.value.response,formattedTicket:y.value.data.formattedTicket.join(" ")});else{const t=a("",n,r,d,m).then((t=>{const o=t.response,a=t.data;return e.set(u,{value:t,timestamp:Date.now()}),{numCommercant:n.trim(),codeBanque:r.trim(),rang:d.trim(),typeContrat:m.trim(),result:o,formattedTicket:a.formattedTicket.join("\n")}}));l.push(t)}}}try{const e=await Promise.all(l);console.log(e),function(e){const t=document.createElement("table");t.classList.add("resultat-table"),t.style.marginTop="20px",t.style.borderCollapse="collapse";const n=document.createElement("thead"),o=document.createElement("tr");["numCommercant","codeBanque","rang","typeContrat","resultat","formattedTicket"].forEach((e=>{const t=document.createElement("th");t.textContent=e,o.appendChild(t)})),n.appendChild(o),t.appendChild(n);const r=document.createElement("tbody");e.forEach((e=>{const{numCommercant:t,codeBanque:n,rang:o,typeContrat:a,result:d,formattedTicket:l}=e,c=document.createElement("tr"),i=document.createElement("td");i.textContent=t,c.appendChild(i);const s=document.createElement("td");s.textContent=n,c.appendChild(s);const p=document.createElement("td");p.textContent=o,c.appendChild(p);const m=document.createElement("td");m.textContent=a,c.appendChild(m);const u=document.createElement("td");u.textContent=d,c.appendChild(u);const y=document.createElement("td"),C=document.createElement("a");C.textContent="Voir le ticket",C.href="#",C.addEventListener("click",(e=>{e.preventDefault(),function(e){const t=document.createElement("div");t.style.backgroundColor="white",t.style.border="1px solid black",t.style.padding="10px",t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.zIndex="9999",t.style.overflow="auto",t.style.height="80%";const n=document.createElement("pre");n.textContent=e;const o=document.createElement("button");o.textContent="Fermer",o.style.marginTop="10px",o.addEventListener("click",(()=>{document.body.removeChild(t)})),t.appendChild(o),t.appendChild(n);const r=document.createElement("button");r.textContent="Fermer",r.style.marginTop="10px",r.addEventListener("click",(()=>{document.body.removeChild(t)})),t.appendChild(r),document.body.appendChild(t)}(l)})),y.appendChild(C),c.appendChild(y),r.appendChild(c)})),t.appendChild(r);document.getElementById("divPrincipale").appendChild(t)}(e),function(e){const t="numCommercant;codeBanque;rang;typeContrat;resultat\n"+e.map((e=>{const{numCommercant:t,codeBanque:n,rang:o,typeContrat:r,result:a,formattedTicket:d}=e;return`"${t}";"${n}";"${o}";"${r}";"${a}";"${d}"`})).join("\n"),n=document.createElement("a");n.href="data:text/csv;charset=utf-8,"+encodeURIComponent("\ufeff"+t),n.download="ticket.csv",n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}(e)}catch(e){console.error(e),n("Une erreur s'est produite lors de l'appel à checkGalitt.")}}async function r(e){const t=e.target.files[0],n=new FileReader;n.onload=async function(e){o(e.target.result)},n.readAsText(t)}function a(e,t,n,o,r){return new Promise(((a,d)=>{const l=`raisonSociale=${e}&numeroCommercant=${t}&codeBanque=${n}&rangTerminal=${o}&initType=${r}`;console.log(l),$.ajax({type:"POST",url:"ws/tlp",timeout:0,data:l,success:function(e){console.log(e);let t="TEST";t=e.chargementReussi?e.ok?e.raisonSocialeOk?"Téléparamétrage réussi ":"Téléparamétrage réussi (Ligne plaque différente de la raison sociale)":"Échec téléparamétrage (Tables obligatoires manquantes : application inactive)":e.connectionError?"Échec téléparamétrage : centre non atteint":e.transferError?"Échec téléparamétrage : erreur de communication":"Échec téléparamétrage : erreur inconnue";a({response:t,data:e})},error:function(e,t,n){"401"===e.status&&setTimeout((function(){window.location="/avem"}),1e3),d(n)}})}))}!function(){const e=document.createElement("style");e.innerHTML="\n\n    /* Style cadre interne */\n    .cadreInterne {\n\t  position : relative;\n      border: 1px solid black;\n      padding: 10px;\n\t  margin: 10px 0;\n\t  border-radius: 5px;\n    }\n\t  .cadreInterne p {\n\t  white-space : pre;\n    }\n    /* Style pour le tableau */\n    .resultat-table {\n      width: 100%;\n      border: 1px solid #ccc;\n\t  font-size: 12px;\n    }\n\n    /* Style pour les cellules du tableau */\n    .resultat-table th,\n    .resultat-table td {\n      padding: 10px;\n      text-align: left;\n      border: 1px solid #ccc;\n    }\n\n    /* Style pour l'en-tête du tableau */\n    .resultat-table th {\n      background-color: #f2f2f2;\n    }\n\n    /* Style pour les liens */\n    .resultat-table a {\n      color: #007bff;\n      text-decoration: none;\n    }\n\n    .resultat-table a:hover {\n      text-decoration: underline;\n    }\n  ",document.head.appendChild(e)}(),function(){const e=document.createElement("div");e.id="divPrincipale",e.style.position="fixed",e.style.top="10px",e.style.right="10px",e.style.width="550px",e.style.height="80%",e.style.overflow="auto",e.style.zIndex="9999",e.style.backgroundColor="white",e.style.border="1px solid black",e.style.padding="10px",e.style.borderRadius="5px",document.body.appendChild(e)}(),function(){const e=document.createElement("div");e.classList.add("cadreInterne");const t=document.createElement("input");t.type="file",t.accept=".csv",t.addEventListener("change",r),t.style.padding="5px 10px",t.style.backgroundColor="#4CAF50",t.style.color="white",t.style.border="none",t.style.borderRadius="4px",t.style.cursor="pointer";const n=document.createElement("p");n.textContent="Option 1 : Cliquez sur le bouton ci-dessous pour importer un fichier CSV \r\n (Format attendu numCommercant;codeBanque;rang;typeContrat) ",e.appendChild(n),e.appendChild(t),document.getElementById("divPrincipale").appendChild(e)}(),async function(){const e=document.createElement("div");e.id="divSaisirDonnees",e.classList.add("cadreInterne");const t=document.createElement("p");t.textContent="Option 2 : Saisir ci-dessous les init à vérifer : \r\n (Format attendu numCommercant;codeBanque;rang;typeContrat) ",e.appendChild(t);const r=document.createElement("textarea");r.setAttribute("id","textareaId"),r.style.width="100%",r.style.height="150px",r.style.marginBottom="10px",e.appendChild(r);const a=document.createElement("button");a.textContent="Générer le fichier CSV",a.style.width="100%",a.style.padding="5px 10px",a.style.backgroundColor="#4CAF50",a.style.color="white",a.style.border="none",a.style.borderRadius="4px",a.style.cursor="pointer",a.addEventListener("click",(()=>{const e=document.getElementById("textareaId").value.trim();e?o(e):n("Veuillez entrer des données dans le textarea.")})),e.appendChild(a),document.getElementById("divPrincipale").appendChild(e)}()}();